{% extends 'html5cda/base.html' %}
{% block content%}
    <div id="studyViewerTemplate" class="tab-pane active" style="height:100%">

    <div class="studyContainer" style="height:100%;">
        <div class="studyRow row" style="height:100%">

            <!-- Thumbnails -->
            <div class="thumbnailSelector">
                <div class="thumbnails list-group">
                </div>
            </div>
            <!-- Viewer -->
            <div class="viewer hidden">
                <!-- Toolbar -->
                <div class="text-center" >
                    <div class="btn-group">
                        <!-- WW/WL -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="WW/WC"><span class="fa fa-sun-o"></span></button>
                        <!-- Invert -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Invert"><span class="fa fa-adjust"></span></button>
                        <!-- Zoom -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Zoom"><span class="fa fa-search"></span></button>
                        <!-- Pan -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Pan"><span class="fa fa-arrows"></span></button>
                        <!-- Stack scroll -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Stack Scroll"><span class="fa fa-bars"></span></button>
                        <!-- Length measurement -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Length Measurement"><span class="fa fa-arrows-v"></span></button>
                        <!-- Angle measurement -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Angle Measurement"><span class="fa fa-angle-left"></span></button>
                        <!-- Pixel probe -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Pixel Probe"><span class="fa fa-dot-circle-o"></span></button>
                        <!-- Elliptical ROI -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Elliptical ROI"><span class="fa fa-circle-o"></span></button>
                        <!-- Rectangle ROI -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Rectangle ROI"><span class="fa fa-square-o"></span></button>
                        <!-- Play clip -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Play Clip"><span class="fa fa-play"></span></button>
                        <!-- Stop clip -->
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Stop Clip"><span class="fa fa-stop"></span></button>
                        <button type="button" class="btn btn-sm btn-default dropdown-toggle" data-container='body' data-toggle="dropdown" aria-expanded="false" data-placement="top" title="Layout"><span class="fa fa-th-large"></span></button>
                        <ul class="pull-right dropdown-menu choose-layout" role="menu">
                            <li><a href="#">1x1</a></li>
                            <li><a href="#">2x1</a></li>
                            <li><a href="#">1x2</a></li>
                            <li><a href="#">2x2</a></li>
                        </ul>
                        <button type="button" class="btn btn-sm btn-default" data-container='body' data-toggle="tooltip" data-placement="bottom" title="Exit"><span class="fa fa-close"></span></button>
                    </div>
                </div>

                <!-- Viewer -->
                <div class="imageViewer">

                </div>
            </div>
            <!-- Editor -->
            <div class="editor">
                <form method="post" action="{% url 'save_template' %}">
                    {% csrf_token %}
                    <header>
                        <input type="hidden" name="PatientIDIssuer" value=""/>
                        <table>
                            <tr>
                                <td class="td1">
                                    PACIENTE id:
                                    <input class="headerId" name="PatientID" type="text" disabled="disabled" value=""/>
                                    <button name="PatientInfo" type="submit" title="más información demográfica sobre el paciente"> más info </button>
                                    nacido:
                                    <input class="headerDate" name="PatientBirthDate" type="text" disabled="disabled" value=""/>
                                    sexo:
                                    <input class="headerMod" name="PatientSex" type="text" disabled="disabled" value=""/>
                                    apellidos^n.:
                                </td>
                                <td class="td2">
                                    <input class="headerName" name="PatientName" type="text" disabled="disabled" value=""/>
                                </td>
                            </tr>
                        </table>
                    </header>
                    <header>
                        <input type="hidden" name="StudyIUID" value=""/>
                        <input type="hidden" name="accessionNumberOID" value=""/>
                        <table>
                            <tr>
                                <td class="td1">
                                    ESTUDIO an:
                                    <input class="headerId" name="AccessionNumber" type="text" disabled="disabled" value=""/>
                                    <button name="StudyInfo" type="submit" title="más información sobre el estudio">más info</button>
                                    fecha :
                                    <input class="headerDate" name="StudyDate" type="text" disabled="disabled" value="" title="fecha estudio"/>
                                    mod.:
                                    <input class="headerMod" name="Modality" type="text" disabled="disabled" value=""/>
                                    descripción:
                                </td>
                                <td class="td2">
                                    <input class="headerName" name="StudyDescription" type="text" value=""/>
                                </td>
                            </tr>
                        </table>
                    </header>
                    <header>
                        <input type="hidden" name="templateID" value="1.2.3"/>
                        <table>
                            <tr>
                                <td class="td1">
                                    PLANTILLA:
                                    <select name="modalidad" id="modalidad">
                                        {% for modalidad in context.modalidades %}
                                            <option value="{{modalidad.modalidad}}"
                                                {% if request.GET.study_modality == modalidad.modalidad %} selected
                                                {% endif %}
                                            >{{modalidad.modalidad}}</option>
                                        {% endfor %}
                                    </select>
                                    <select name="estudio" id="estudio">
                                        <!-- <option value="code^codeSystem^codeSystemName">displayNameProcedimiento</option> -->
                                    </select>
                                    <!--copiar displayNameProcedimiento seleccionado en descripción-->
                                </td>
                                <td class="td2">
                                    <select name="plantilla" id="plantilla">
                                    </select>
                                </td>
                                <script type="text/javascript">
                                    $("#modalidad").change(function() {
                                        $('#editor_template').html('');
                                        $.ajax({
                                            url: '{% url 'studies_list' %}',
                                            data: 'modalidad=' + $("#modalidad").val(),
                                            type: 'get',
                                            success: function(data) {
                                                $('#estudio').empty();
                                                for(var item in data.studies_list){
                                                    var options = '';
                                                    if(data.studies_list[item].description == '{{ request.GET.study_description }}'){
                                                        options = '<option value="' + data.studies_list[item].id + '" selected="selected">' + data.studies_list[item].description + '</option>';
                                                    }else{
                                                        options = '<option value="' + data.studies_list[item].id + '">' + data.studies_list[item].description + '</option>';
                                                    }
                                                    $('#estudio').append(options);
                                                }
                                                $("#estudio").trigger('change');
                                            },
                                            failure: function(data) {
                                                console.info('Error get studies_list');
                                            }
                                        });
                                    })
                                    $("#estudio").change(function() {
                                        $('#editor_template').html('');
                                        $.ajax({
                                            url: '{% url 'template_list' %}',
                                            data: 'estudio=' + $("#estudio").val(),
                                            type: 'get',
                                            success: function(data) {
                                                $('#plantilla').empty();
                                                for(var item in data.template_list){
                                                    var options = '';
                                                    options = '<option value="' + data.template_list[item].id + '">' + data.template_list[item].description + '</option>';
                                                    $('#plantilla').append(options);
                                                }
                                                $("#plantilla").trigger('change');
                                            },
                                            failure: function(data) {
                                                console.info('Error get template_list');
                                            }
                                        });
                                    })
                                    $("#plantilla").change(function() {
                                        $('#editor_template').html('');
                                        $.ajax({
                                            url: '{% url 'get_template' %}',
                                            data: 'template=' + $("#plantilla").val(),
                                            type: 'get',
                                            success: function(data) {
                                                $('#editor_template').html(data);
                                            },
                                            failure: function(data) {
                                                console.info('Error get template');
                                            }
                                        });
                                    })
                                    $("#modalidad").trigger('change');
                                </script>
                            </tr>
                        </table>
                    </header>
                    <div id="editor_template">

                    </div>
                    <footer>
                <input class="displayNone" type="radio" name="firma1" value="notToBeSigned"></input>
                <input class="displayNone" type="radio" name="firma1" value="toBeSigned"></input>
                <input class="displayNone" type="radio" name="firma1" value="signed" checked="checked"></input>
                <article class="firma">
                    <input
                        type="hidden"
                        name="fkfirma1"
                        value=""
                        ></input>
                    <button name="guardar" type="submit" title="sin firmar">guardar</button>
                    <label>radiólogo: <input name="usuario1" type="text" class="footer"></input></label>
                    <label>clave: <input name="clave1" type="password" class="footer"></input></label>
                    <button name="firmar" type="submit" class="sign" title="firmar sin autenticar">firmar</button>
                    <button name="firmarAutenticar" type="submit" class="sign" title="firmar y autenticar">autenticar</button>
                    <button name="borrarPlantilla" type="submit">borrar plantilla</button>
                    <button name="crearPlantilla" type="submit">crear plantilla</button>
                 </article>
            </footer>
            <footer>
                <input class="displayNone" type="radio" name="firma2" value="notToBeSigned"></input>
                <input class="displayNone" type="radio" name="firma2" value="toBeSigned" checked="checked"></input>
                <input class="displayNone" type="radio" name="firma2" value="signed"></input>
                <article>
                    <input
                        type="hidden"
                        name="fkfirma2"
                        value=""
                        ></input>
                    <button name="guardar" type="submit" title="sin firmar">guardar</button>
                    <label>radiólogo: <input name="usuario2" type="text" class="footer"></input></label>
                    <label>clave: <input name="clave2" type="password" class="footer"></input></label>
                    <button name="firmar" type="submit" class="sign" title="firmar sin autenticar">firmar</button>
                    <button name="firmarAutenticar" type="submit" class="sign" title="firmar y autenticar">autenticar</button>
                    <button name="borrarPlantilla" type="submit">borrar plantilla</button>
                    <button name="crearPlantilla" type="submit">crear plantilla</button>
                </article>
            </footer>
            <footer>
                <input class="displayNone" type="radio" name="firma3" value="notToBeSigned" checked="checked"></input>
                <input class="displayNone" type="radio" name="firma3" value="toBeSigned"></input>
                <input class="displayNone" type="radio" name="firma3" value="signed"></input>
                <article>
                    <input
                        type="hidden"
                        name="fkfirma3"
                        value=""
                        ></input>
                    <button name="guardar" type="submit" title="sin firmar">guardar</button>
                    <label>radiólogo: <input name="usuario3" type="text" class="footer"></input></label>
                    <label>clave: <input name="clave3" type="password" class="footer"></input></label>
                    <button name="firmar" type="submit" class="sign" title="firmar sin autenticar">firmar</button>
                    <button name="firmarAutenticar" type="submit" class="sign" title="firmar y autenticar">autenticar</button>
                    <button name="borrarPlantilla" type="submit">borrar plantilla</button>
                    <button name="crearPlantilla" type="submit">crear plantilla</button>
                </article>
            </footer>
            <footer>
                <select id="evaluar" name="evaluar" class="gris" title="esta evaluación no forma parte del documento clínico y no está comunicada al paciente">
                    <option value="sin evaluación" selected="selected">por favor, evalue el caso ...</option>
                    <option value="normal">normal</option>
                    <option value="patológico con relación al dato clinico">patológico con relación al dato clinico</option>
                    <option value="patológico sin relación con el dato clínico">patológico sin relación al dato clinico</option>
                    <option value="dudoso">dudoso</option>
                </select>
                <!-- "TIPOHALLAZGO" queda exclusivamente registrado en el atributo (0040,E008) "Document Class Code Sequence" del contenedor DICOM del CDA.
                (0040,E008) contiene "Additional classifications of the document, beyond the title represented in Concept Name Code Sequence."
                Es equivalente a HL7 v2.x TXA-2.
                -->
            </footer>
            </form>
            </div>
        </div>
        <!-- <div style="clear:both;"></div>-->
    </div>
</div>
{% endblock %}